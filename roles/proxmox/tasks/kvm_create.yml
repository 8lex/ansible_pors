---
- name: generate VM {{ server_shortname }} tasks
  template:
    src: create_kvm.j2
    dest: "{{ base_install_dir }}/roles/proxmox/tasks/generated_create_vm.yml"
  connection: local
  loop: "{{ disks }}"

#########################################################################
# The Proxmox ansible modules do not offer to attach disks to an already
# running instance.
# the following tasks file gets auto-generated by the above template:
#########################################################################

- include_tasks: "{{ base_install_dir }}/roles/proxmox/tasks/generated_create_vm.yml"

- name: give PVE enough time to write the config
  pause:
    seconds: 5
